name: PR Check

on:
  push:      # 全てのブランチへの push 時に実行
  pull_request: # プルリクエスト作成時に実行

jobs:
  build: # 既存のダミービルド（変更不要ならそのまま残します）
    name: Run Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
      - name: Run build
        run: echo "Running build..." # 実際には必要なスクリプトやコマンドを記述

  prettier-check:
    name: Prettier format check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
      - name: Use Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '24'
      - name: Run Prettier check
        shell: bash
        run: |
          set -euo pipefail
          FILES="**/*.{js,ts,jsx,tsx,json,md,css,scss,html,yml,yaml}"

          echo "Checking for package.json and local prettier..."
          if [ -f package.json ]; then
            if grep -q "\"prettier\"" package.json 2>/dev/null; then
              echo "Found prettier in package.json — using npx to run project-local prettier"
              npx --yes prettier --version
              npx --yes prettier --check "$FILES"
              exit 0
            else
              echo "package.json found but no prettier entry. Will try npx remote or fallback."
            fi
          fi

          # Try npx (it will download remote prettier if not installed locally)
          if command -v npx >/dev/null 2>&1; then
            echo "Attempting to run Prettier via npx..."
            if npx --yes prettier --version >/dev/null 2>&1; then
              npx --yes prettier --check "$FILES"
              exit 0
            else
              echo "npx failed to run Prettier; will install globally as fallback"
            fi
          else
            echo "npx not available; will install Prettier globally as fallback"
          fi

          npm install -g prettier
          prettier --version
          prettier --check "$FILES"

